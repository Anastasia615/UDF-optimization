#  –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ F_WORKS_LIST 
# –í—ã–ø–æ–ª–Ω–∏–ª–∞: –•–æ—Ö—É–ª–∏–Ω–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è 

## –¶–µ–ª—å
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é `F_WORKS_LIST` –≤ MS SQL Server, —É—Å—Ç—Ä–∞–Ω–∏–≤ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –º–µ–Ω–µ–µ 2 —Å–µ–∫—É–Ω–¥ –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ 3000 —Å—Ç—Ä–æ–∫ –∏–∑ 50 000.

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–°–æ–∑–¥–∞–Ω—ã —Ç–∞–±–ª–∏—Ü—ã:
- `Works` ‚Äî 50 000 –∑–∞–ø–∏—Å–µ–π
- `WorkItem` ‚Äî 150 000 –∑–∞–ø–∏—Å–µ–π (‚âà3 –Ω–∞ –∑–∞–∫–∞–∑)
- `Employee`, `WorkStatus`, `Analiz` ‚Äî —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: —Å–º. [generate_data.sql](generate_data.sql)

---

## 2. –ê–Ω–∞–ª–∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–°–º. [Issue #1](https://github.com/Anastasia615/UDF-optimization/issues/1)

–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
| –ü—Ä–æ–±–ª–µ–º–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|----------|
|  –°–∫–∞–ª—è—Ä–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ | `F_WORKITEMS_COUNT_BY_ID_WORK` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–≤–∞–∂–¥—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é —Ç–∞–±–ª–∏—Ü—ã WorkItem |
|  –í—ã–∑–æ–≤ UDF `F_EMPLOYEE_FULLNAME` | –ö–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JOIN –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –æ–±—Ä–∞—â–µ–Ω–∏—è–º –∫ —Ç–∞–±–ª–∏—Ü–µ Employee |
|  ORDER BY + TOP | –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—Å–µ—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –≤—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ |
|  –¢–∞–±–ª–∏—á–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è @RESULT | –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚Äî –ø–ª–æ—Ö–æ–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è |
|  –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ | –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –¥–ª—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π |
|  –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è | –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏ |
|  –ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö | –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –ø–æ–ª–µ–π –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ NOT NULL –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π |

---

## 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å

–°–º. [Issue #2](https://github.com/Anastasia615/UDF-optimization/issues/2)

### –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:
```sql
CREATE INDEX IX_WorkItem_Work_Complit 
ON WorkItem (id_work, is_complit)
INCLUDE (id_analiz);

CREATE INDEX IX_Works_Id_Work 
ON Works (Id_Work DESC)
INCLUDE (CREATE_Date, MaterialNumber, IS_Complit, FIO, StatusId);

CREATE INDEX IX_Analiz_IsGroup 
ON Analiz (is_group)
INCLUDE (id_analiz);
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–æ–º—Ç—ã –¥–ª—è LLM:
1. "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π SQL-–∑–∞–ø—Ä–æ—Å –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É–∑–∫–∏—Ö –º–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
2. "–ü—Ä–µ–¥–ª–æ–∂–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é SQL-–∑–∞–ø—Ä–æ—Å–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î"
3. "–ö–∞–∫ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ–º–æ—â—å—é –∏–Ω–¥–µ–∫—Å–æ–≤?"

### –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:
```sql
SELECT TOP (3000)
    w.Id_Work,
    w.CREATE_Date,
    w.MaterialNumber,
    w.IS_Complit,
    w.FIO,
    CONVERT(VARCHAR(10), w.CREATE_Date, 104) AS D_DATE,
    SUM(CASE WHEN wi.is_complit = 0 AND a.is_group = 0 THEN 1 ELSE 0 END) AS WorkItemsNotComplit,
    SUM(CASE WHEN wi.is_complit = 1 AND a.is_group = 0 THEN 1 ELSE 0 END) AS WorkItemsComplit,
    e.FULL_NAME + ' ' + UPPER(LEFT(e.Name,1)) + '. ' + UPPER(LEFT(e.Patronymic,1)) + '.' AS EmployeeFullName,
    w.StatusId,
    ws.StatusName,
    CASE
      WHEN w.Print_Date IS NOT NULL OR w.SendToClientDate IS NOT NULL
        OR w.SendToDoctorDate IS NOT NULL OR w.SendToOrgDate IS NOT NULL
        OR w.SendToFax IS NOT NULL
      THEN 1 ELSE 0
    END AS Is_Print
FROM Works w
LEFT JOIN WorkItem wi ON wi.id_work = w.Id_Work
LEFT JOIN Analiz a ON a.id_analiz = wi.id_analiz AND a.is_group = 0
LEFT JOIN Employee e ON e.Id_Employee = w.Id_Employee
LEFT JOIN WorkStatus ws ON w.StatusId = ws.StatusID
WHERE w.IS_DEL <> 1
GROUP BY
  w.Id_Work, w.CREATE_Date, w.MaterialNumber, w.IS_Complit, w.FIO,
  e.Surname, e.Name, e.Patronymic,
  w.StatusId, ws.StatusName,
  w.Print_Date, w.SendToClientDate,
  w.SendToDoctorDate, w.SendToOrgDate, w.SendToFax
ORDER BY w.Id_Work DESC;
```

---

## 4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|--------|-----|--------|
| –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | ~20 —Å–µ–∫ | ~1.5 —Å–µ–∫ |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ UDF | –î–∞ | –ù–µ—Ç |
| –ò–º–µ—é—Ç—Å—è GROUP BY / JOIN | –ù–µ—Ç | –î–∞ |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Ç–∞–±–ª–∏—Ü | 2N+1 | N |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ | –ù–µ—Ç | –î–∞ |
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ computed columns | –ù–µ—Ç | –î–∞ |
| –†–∞–∑–º–µ—Ä –ø–ª–∞–Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ë–æ–ª—å—à–æ–π | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π |
| –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö —á—Ç–µ–Ω–∏–π | –í—ã—Å–æ–∫–æ–µ | –ù–∏–∑–∫–æ–µ |

---

## 5. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–°–º. [Issue #3](https://github.com/Anastasia615/UDF-optimization/issues/3)

### üí° –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. –ò–Ω–¥–µ–∫—Å –Ω–∞ `(WorkItem.id_work, is_complit)`
   - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–¥—Å—á–µ—Ç–∞ –≥–æ—Ç–æ–≤—ã—Ö/–Ω–µ–≥–æ—Ç–æ–≤—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏: 
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
     - –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
     - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–Ω–¥–µ–∫—Å–∞

2. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ computed column –¥–ª—è –§–ò–û
   ```sql
   ALTER TABLE Employee DROP COLUMN FULL_NAME;
   ALTER TABLE Employee
   ADD FullName AS (
       Surname + ' ' + 
       UPPER(LEFT(Name,1)) + '. ' + 
       UPPER(LEFT(Patronymic,1)) + '.'
   ) PERSISTED;
   ```
   - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞: 
     - –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –§–ò–û
     - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
     - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
     - –ó–∞–º–µ–¥–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
     - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –§–ò–û

3. –ö—ç—à-—Ç–∞–±–ª–∏—Ü–∞ `Works_Stats` —Å —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏
   - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
     - –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
     - –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
     - –£–ª—É—á—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
     - –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
     - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
     - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –≤ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö

4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
   ```sql
   ALTER TABLE Works
   ALTER COLUMN FIO VARCHAR(100) NOT NULL;
   
   ALTER TABLE Works
   ALTER COLUMN MaterialNumber DECIMAL(10,2) NOT NULL;
   ```
   - –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
     - –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö
     - –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
     - –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:
     - –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö
     - –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é
     - –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫):**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ WorkItem
   - –í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: 1-2 —á–∞—Å–∞
   - –†–∏—Å–∫: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
   - –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–¥: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫):**
   - –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ computed column
   - –í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: 2-4 —á–∞—Å–∞
   - –†–∏—Å–∫: —Å—Ä–µ–¥–Ω–∏–π
   - –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–¥: –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ

3. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫):**
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
   - –í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: 4-8 —á–∞—Å–æ–≤
   - –†–∏—Å–∫: —Å—Ä–µ–¥–Ω–∏–π
   - –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–¥: —Å—Ä–µ–¥–Ω–µ–µ

4. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4 (–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫):**
   - –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫—ç—à-—Ç–∞–±–ª–∏—Ü—ã
   - –í—Ä–µ–º—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è: 1-2 –¥–Ω—è
   - –†–∏—Å–∫: –≤—ã—Å–æ–∫–∏–π
   - –í–ª–∏—è–Ω–∏–µ –Ω–∞ –∫–æ–¥: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ
